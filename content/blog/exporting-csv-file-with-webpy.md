---
title: "Exporting a csv file with web.py"
date: "2007-11-25"
tags: ["python", "web.py"]
slug: "exporting-csv-file-with-webpy"

---

This is how you export a csv file and get the browser to recognize that its a csv file and popups the download window with web.py.  Lets say we have a database with a table called users and you want to create a csv file that contains all the users with their names and id's here is how you do it.<br /><br /><div><br /><span style="color: rgb(252, 243, 5);"> 1 </span><span style="color: rgb(255, 255, 96);"><b>class</b></span> <span style="color: rgb(64, 255, 255);">export</span>:<br /><span style="color: rgb(252, 243, 5);"> 2     </span>    <span style="color: rgb(255, 255, 96);">&nbsp;&nbsp;&nbsp;&nbsp;<b>def</b></span> <span style="color: rgb(64, 255, 255);">GET</span>(self):<br /><span style="color: rgb(252, 243, 5);"> 3 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i = web.input()<br /><span style="color: rgb(252, 243, 5);"> 4 </span><br /><span style="color: rgb(252, 243, 5);"> 5 </span><br /><span style="color: rgb(252, 243, 5);"> 6 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;users = web.select('<span style="color: rgb(255, 160, 160);">users</span>', vars=locals())<br /><span style="color: rgb(252, 243, 5);"> 7 </span><br /><span style="color: rgb(252, 243, 5);"> 8           </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;csv = []<br /><span style="color: rgb(252, 243, 5);"> 9 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;csv.append("<span style="color: rgb(255, 160, 160);">id,name</span><span style="color: rgb(252, 128, 0);">\n</span>")<br /><span style="color: rgb(252, 243, 5);">10 </span>        <span style="color: rgb(255, 255, 96);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>for</b></span> user <span style="color: rgb(255, 255, 96);"><b>in</b></span> users:<br /><span style="color: rgb(252, 243, 5);">11 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row = []<br /><span style="color: rgb(252, 243, 5);">12 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.append(user.id)<br /><span style="color: rgb(252, 243, 5);">13 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;row.append(user.name)<br /><span style="color: rgb(252, 243, 5);">14 </span><br /><span style="color: rgb(252, 243, 5);">15 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;csv.append("<span style="color: rgb(255, 160, 160);">,</span>".join(row))<br /><span style="color: rgb(252, 243, 5);">16 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(128, 160, 255);">#writer.writerow(row)</span><br /><span style="color: rgb(252, 243, 5);">17 </span>     <br /><span style="color: rgb(252, 243, 5);">18 </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(128, 160, 255);">#f.close()</span><br /><span style="color: rgb(252, 243, 5);">19 </span><br /><span style="color: rgb(252, 243, 5);">20 </span>&nbsp;&nbsp;&nbsp;&nbsp;web.header('<span style="color: rgb(255, 160, 160);">Content-Type</span>','<span style="color: rgb(255, 160, 160);">text/csv</span>')<br /><span style="color: rgb(252, 243, 5);">21 </span>&nbsp;&nbsp;&nbsp;&nbsp;web.header('<span style="color: rgb(255, 160, 160);">Content-disposition</span>', '<span style="color: rgb(255, 160,160);">attachment; filename=export.csv</span>')<br /><span style="color: rgb(252, 243, 5);">22 </span>        <span style="color: rgb(255, 255, 96);">&nbsp;&nbsp;&nbsp;&nbsp;<b>print</b></span> "".join(csv)<br /><span style="color: rgb(252, 243, 5);">23 </span>        <span style="color: rgb(255, 255, 96);">&nbsp;&nbsp;&nbsp;&nbsp;<b>return</b></span><br /><br /></div><br /><br /><br />I export the csv file  in a GET method of a class called export which i map in the urls list to '/export','export'<br /><br />A quick breakdown, do a database query and iterate over the IterBetter object create a row and appending a comma seperated string to the csv list. Then at the end you send the appropirate HTTP headers , the first telling the type of the file and the second setting the filename and extension.<br /><br />Anyway you can download this code from <a href="https://bulkanix.pastebin.com/f1f567ea0">https://bulkanix.pastebin.com/f1f567ea0</a>
